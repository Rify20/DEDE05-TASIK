<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard • DEDE05 TASIK</title>

    <!-- Font Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-soft: #eff6ff;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-500: #6b7280;
            --gray-700: #374151;
            --gray-800: #1f2933;
            --danger: #ef4444;
            --success: #10b981;
            --radius: 10px;
            --shadow: 0 12px 30px rgba(15, 23, 42, 0.12);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gray-50);
            color: var(--gray-800);
            min-height: 100vh;
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: #0f172a;
            color: white;
            padding: 24px 20px;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 32px;
        }

        .sidebar-logo {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            object-fit: cover;
        }

        .sidebar-title {
            font-weight: 700;
            font-size: 1.05rem;
        }

        .sidebar-subtitle {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .nav {
            list-style: none;
            margin-top: 10px;
            flex: 1;
        }

        .nav li {
            margin-bottom: 6px;
        }

        .nav button {
            width: 100%;
            padding: 10px 12px;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: #e5e7eb;
            font-size: 0.92rem;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: 0.2s;
        }

        .nav button span.badge {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 999px;
            background: rgba(59, 130, 246, 0.2);
            color: #bfdbfe;
        }

        .nav button:hover {
            background: rgba(148, 163, 184, 0.2);
        }

        .nav button.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .sidebar-footer {
            margin-top: 20px;
            border-top: 1px solid rgba(148, 163, 184, 0.25);
            padding-top: 14px;
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .sidebar-footer strong {
            color: #e5e7eb;
        }

        .logout-btn {
            margin-top: 10px;
            width: 100%;
            padding: 9px 12px;
            border-radius: 8px;
            border: 1px solid rgba(248, 113, 113, 0.6);
            background: rgba(239, 68, 68, 0.05);
            color: #fecaca;
            font-size: 0.9rem;
            cursor: pointer;
            transition: 0.2s;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.12);
        }

        /* Main content */
        .main {
            flex: 1;
            padding: 24px 26px;
            max-width: 100%;
        }

        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }

        .main-header h1 {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .main-header small {
            display: block;
            font-size: 0.85rem;
            color: var(--gray-500);
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 7px 10px;
            border-radius: 999px;
            font-size: 0.8rem;
            background: var(--primary-soft);
            color: var(--primary-dark);
        }

        .content {
            margin-top: 10px;
        }

        .card {
            background: white;
            border-radius: var(--radius);
            padding: 18px 18px 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-100);
            margin-bottom: 18px;
        }

        .card h2 {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .card small {
            color: var(--gray-500);
            font-size: 0.82rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .form-group {
            margin-top: 10px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .form-control,
        .form-select,
        textarea {
            width: 100%;
            padding: 10px 11px;
            border-radius: 8px;
            border: 1px solid var(--gray-300);
            font-size: 0.9rem;
            font-family: inherit;
            transition: 0.2s;
        }

        .form-control:focus,
        .form-select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
        }

        textarea {
            resize: vertical;
            min-height: 70px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 9px 14px;
            border-radius: 8px;
            border: none;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 18px rgba(37, 99, 235, 0.35);
        }

        .btn-ghost {
            background: transparent;
            color: var(--gray-700);
        }

        .btn-ghost:hover {
            background: var(--gray-100);
        }

        .btn-danger {
            background: rgba(248, 113, 113, 0.1);
            color: #b91c1c;
        }

        .btn-danger:hover {
            background: rgba(248, 113, 113, 0.2);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.85rem;
        }

        .table th,
        .table td {
            padding: 8px 6px;
            border-bottom: 1px solid var(--gray-200);
            text-align: left;
            vertical-align: top;
        }

        .table th {
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.8rem;
        }

        .tag {
            display: inline-flex;
            align-items: center;
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 0.75rem;
            background: var(--gray-100);
            color: var(--gray-700);
        }

        .tag-success {
            background: rgba(16, 185, 129, 0.12);
            color: #059669;
        }

        .tag-warning {
            background: rgba(234, 179, 8, 0.12);
            color: #b45309;
        }

        .tag-danger {
            background: rgba(248, 113, 113, 0.12);
            color: #b91c1c;
        }

        .notification {
            position: fixed;
            right: 22px;
            bottom: 22px;
            background: #111827;
            color: white;
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 0.85rem;
            box-shadow: 0 12px 30px rgba(0,0,0,0.4);
            opacity: 0;
            transform: translateY(10px);
            transition: 0.2s;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        @media (max-width: 900px) {
            .sidebar {
                display: none;
            }

            body {
                display: block;
            }

            .main {
                padding: 16px;
            }
        }

        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .card {
                padding: 14px 12px 16px;
            }

            .main-header h1 {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar">
    <div class="sidebar-header">
        <img src="assets/logo.png" alt="Logo DEDE05 TASIK" class="sidebar-logo">
        <div>
            <div class="sidebar-title">DEDE05 TASIK</div>
            <div class="sidebar-subtitle">Admin Panel</div>
        </div>
    </div>

    <ul class="nav">
        <li><button class="nav-link active" data-target="tab-packages">Paket Internet</button></li>
        <li><button class="nav-link" data-target="tab-faq">FAQ</button></li>
        <li><button class="nav-link" data-target="tab-settings">Pengaturan Website</button></li>
        <li><button class="nav-link" data-target="tab-reports">Laporan Gangguan <span class="badge" id="badgeReports">0</span></button></li>
    </ul>

    <div class="sidebar-footer">
        <div>Login sebagai: <strong>admin</strong></div>
        <button class="logout-btn" id="logoutBtn">Logout</button>
    </div>
</aside>

<!-- MAIN -->
<main class="main">
    <header class="main-header">
        <div>
            <h1>Dashboard Admin</h1>
            <small>Kelola konten yang tampil di halaman utama DEDE05 TASIK.</small>
        </div>
        <div class="pill">
            • Mode Lokal
            <span>Data disimpan di browser (localStorage)</span>
        </div>
    </header>

    <section class="content">
        <!-- TAB: PAKET INTERNET -->
        <div class="tab" id="tab-packages">
            <div class="card">
                <h2>Paket Internet</h2>
                <small>Tambah, ubah, dan hapus paket yang muncul di homepage.</small>

                <div class="form-row" style="margin-top: 14px;">
                    <div class="form-group">
                        <label for="pkgName">Nama Paket</label>
                        <input type="text" id="pkgName" class="form-control" placeholder="Mis: Standard">
                    </div>
                    <div class="form-group">
                        <label for="pkgSpeed">Kecepatan (Mbps)</label>
                        <input type="number" id="pkgSpeed" class="form-control" placeholder="Mis: 20">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="pkgPrice">Harga / bulan (contoh: Rp 199.000)</label>
                        <input type="text" id="pkgPrice" class="form-control" placeholder="Rp 199.000">
                    </div>
                    <div class="form-group">
                        <label for="pkgStatus">Status</label>
                        <select id="pkgStatus" class="form-select">
                            <option value="active">Aktif</option>
                            <option value="inactive">Nonaktif</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="pkgFeatures">Fitur (satu per baris)</label>
                        <textarea id="pkgFeatures" placeholder="Unlimited Bandwidth&#10;Untuk 1-3 perangkat&#10;Support 24/7"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Populer?</label>
                        <select id="pkgPopular" class="form-select">
                            <option value="false">Tidak</option>
                            <option value="true">Ya</option>
                        </select>
                        <div style="margin-top: 18px;">
                            <button class="btn btn-primary" id="btnSavePackage">Simpan Paket</button>
                            <button class="btn btn-ghost" id="btnClearPackageForm">Bersihkan Form</button>
                        </div>
                    </div>
                </div>

                <input type="hidden" id="pkgEditingId" value="">
            </div>

            <div class="card">
                <h2>Daftar Paket</h2>
                <small>Klik "Edit" untuk memasukkan data paket ke form di atas.</small>

                <table class="table" id="packagesTable">
                    <thead>
                        <tr>
                            <th>Nama</th>
                            <th>Speed</th>
                            <th>Harga</th>
                            <th>Status</th>
                            <th>Populer</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- diisi via JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TAB: FAQ -->
        <div class="tab" id="tab-faq" style="display:none;">
            <div class="card">
                <h2>FAQ</h2>
                <small>Kelola pertanyaan yang tampil di bagian FAQ website.</small>

                <div class="form-group" style="margin-top: 14px;">
                    <label for="faqQuestion">Pertanyaan</label>
                    <input type="text" id="faqQuestion" class="form-control" placeholder="Contoh: Berapa lama proses pemasangan?">
                </div>
                <div class="form-group">
                    <label for="faqAnswer">Jawaban</label>
                    <textarea id="faqAnswer" placeholder="Tulis jawaban untuk pelanggan di sini..."></textarea>
                </div>
                <div>
                    <button class="btn btn-primary" id="btnSaveFAQ">Simpan FAQ</button>
                    <button class="btn btn-ghost" id="btnClearFAQForm">Bersihkan Form</button>
                </div>
                <input type="hidden" id="faqEditingIndex" value="">
            </div>

            <div class="card">
                <h2>Daftar FAQ</h2>
                <table class="table" id="faqTable">
                    <thead>
                        <tr>
                            <th>Pertanyaan</th>
                            <th>Jawaban</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- diisi via JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- TAB: SETTINGS -->
        <div class="tab" id="tab-settings" style="display:none;">
            <div class="card">
                <h2>Pengaturan Website</h2>
                <small>Konten teks yang akan tampil di homepage (hero, tentang, footer & kontak).</small>

                <div class="form-group" style="margin-top: 14px;">
                    <label for="heroTitle">Judul Hero</label>
                    <input type="text" id="heroTitle" class="form-control" placeholder="Stabil untuk Semua Kebutuhan">
                </div>
                <div class="form-group">
                    <label for="heroDescription">Deskripsi Hero</label>
                    <textarea id="heroDescription" placeholder="Teks singkat di bagian atas halaman..."></textarea>
                </div>

                <div class="form-group">
                    <label for="aboutTitle">Judul Tentang Kami</label>
                    <input type="text" id="aboutTitle" class="form-control" placeholder="Tentang DEDE05 TASIK">
                </div>

                <div class="form-group">
                    <label for="aboutDescription1">Tentang Kami - Paragraf 1</label>
                    <textarea id="aboutDescription1"></textarea>
                </div>

                <div class="form-group">
                    <label for="aboutDescription2">Tentang Kami - Paragraf 2</label>
                    <textarea id="aboutDescription2"></textarea>
                </div>

                <div class="form-group">
                    <label for="footerDescription">Deskripsi Footer</label>
                    <textarea id="footerDescription" placeholder="Penyedia layanan internet lokal di Tasikmalaya ..."></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="whatsapp">Nomor WhatsApp / Telepon</label>
                        <input type="text" id="whatsapp" class="form-control" placeholder="0812-XXXX-XXXX">
                    </div>
                    <div class="form-group">
                        <label for="email">Email Support</label>
                        <input type="email" id="email" class="form-control" placeholder="support@dede05tasik.local">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="address">Alamat</label>
                        <input type="text" id="address" class="form-control" placeholder="Jl. Contoh No.12, Tasikmalaya">
                    </div>
                    <div class="form-group">
                        <label for="workingHours">Jam Operasional</label>
                        <input type="text" id="workingHours" class="form-control" placeholder="Senin-Minggu: 08:00-20:00">
                    </div>
                </div>

                <div style="margin-top: 10px;">
                    <button class="btn btn-primary" id="btnSaveSettings">Simpan Pengaturan</button>
                </div>
            </div>
        </div>

        <!-- TAB: REPORTS -->
        <div class="tab" id="tab-reports" style="display:none;">
            <div class="card">
                <h2>Laporan Gangguan</h2>
                <small>Laporan ini berasal dari form “Lapor Gangguan” di website utama.</small>

                <table class="table" id="reportsTable" style="margin-top: 14px;">
                    <thead>
                        <tr>
                            <th>Nama</th>
                            <th>Kontak</th>
                            <th>Alamat</th>
                            <th>Masalah</th>
                            <th>Tanggal</th>
                            <th>Status</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- diisi via JS -->
                    </tbody>
                </table>

                <div style="margin-top: 10px;">
                    <button class="btn btn-ghost" id="btnClearReports">Hapus Semua Laporan</button>
                </div>
            </div>
        </div>
    </section>
</main>

<div class="notification" id="notificationBox"></div>

<script>
    // Proteksi: jika belum login, lempar ke halaman login
    if (localStorage.getItem('adminLoggedIn') !== 'true') {
        window.location.href = 'admin-login.html';
    }

    function showNotification(message) {
        const box = document.getElementById('notificationBox');
        box.textContent = message;
        box.classList.add('show');
        setTimeout(() => box.classList.remove('show'), 2500);
    }

    function safeParseJSON(value, fallback) {
        try {
            return JSON.parse(value);
        } catch (e) {
            return fallback;
        }
    }

    // Default data
    const defaultPackages = [
        {
            id: 1,
            name: "Basic",
            speed: "10 Mbps",
            price: "Rp 99.000",
            features: ["Unlimited Bandwidth", "Untuk 1-3 perangkat", "Streaming SD", "Support 24/7"],
            status: "active",
            popular: false
        },
        {
            id: 2,
            name: "Standard",
            speed: "20 Mbps",
            price: "Rp 199.000",
            features: ["Unlimited Bandwidth", "Untuk 5-8 perangkat", "Streaming HD", "Prioritas Teknisi"],
            status: "active",
            popular: true
        },
        {
            id: 3,
            name: "Premium",
            speed: "50 Mbps",
            price: "Rp 349.000",
            features: ["Unlimited Bandwidth", "Untuk 10+ perangkat", "Streaming 4K & Gaming", "SLA Khusus"],
            status: "active",
            popular: false
        }
    ];

    const defaultFAQ = [
        {
            question: "Apa itu FUP (Fair Usage Policy)?",
            answer: "FUP adalah kebijakan penggunaan wajar. Kami memberikan batasan tertentu pada kecepatan setelah penggunaan data melebihi ambang tertentu pada beberapa paket promosi untuk menjaga kualitas jaringan bagi semua pelanggan."
        },
        {
            question: "Bagaimana cara membayar tagihan?",
            answer: "Pembayaran dapat dilakukan lewat transfer bank (BCA, BRI, BNI, Mandiri), e-wallet (GoPay, OVO, Dana), atau aplikasi pembayaran yang tertera di invoice. Kami juga menerima pembayaran via minimarket (Alfamart, Indomaret) dengan tambahan biaya admin."
        },
        {
            question: "Berapa lama proses pemasangan?",
            answer: "Standar pemasangan adalah 2-5 hari kerja tergantung ketersediaan tim dan lokasi Anda. Untuk area prioritas di Tasikmalaya kota, bisa lebih cepat dalam 1-2 hari kerja setelah survey lokasi selesai."
        },
        {
            question: "Bagaimana cara meminta teknisi?",
            answer: "Gunakan form \"Lapor Gangguan\" pada website atau hubungi WhatsApp support kami. Teknisi kami akan menghubungi Anda untuk jadwal kunjungan dalam waktu 2-4 jam pada jam operasional."
        }
    ];

    // Data state
    let packages = [];
    let faqItems = [];
    let settings = {};
    let reports = [];

    function loadData() {
        packages = safeParseJSON(localStorage.getItem('websitePackages'), defaultPackages);
        faqItems = safeParseJSON(localStorage.getItem('websiteFAQ'), defaultFAQ);
        settings = safeParseJSON(localStorage.getItem('websiteSettings'), {});
        reports = safeParseJSON(localStorage.getItem('websiteReports'), []);
    }

    function savePackages() {
        localStorage.setItem('websitePackages', JSON.stringify(packages));
        showNotification('Paket internet berhasil disimpan.');
    }

    function saveFAQ() {
        localStorage.setItem('websiteFAQ', JSON.stringify(faqItems));
        showNotification('FAQ berhasil disimpan.');
    }

    function saveSettings() {
        localStorage.setItem('websiteSettings', JSON.stringify(settings));
        showNotification('Pengaturan website berhasil disimpan.');
    }

    function saveReports() {
        localStorage.setItem('websiteReports', JSON.stringify(reports));
        updateReportsBadge();
    }

    // Render functions
    function renderPackages() {
        const tbody = document.querySelector('#packagesTable tbody');
        tbody.innerHTML = '';

        packages.forEach(pkg => {
            const tr = document.createElement('tr');

            const statusTag = pkg.status === 'active'
                ? '<span class="tag tag-success">Aktif</span>'
                : '<span class="tag tag-warning">Nonaktif</span>';

            tr.innerHTML = `
                <td>${pkg.name}</td>
                <td>${pkg.speed}</td>
                <td>${pkg.price}</td>
                <td>${statusTag}</td>
                <td>${pkg.popular ? '<span class="tag tag-success">Populer</span>' : '-'}</td>
                <td>
                    <button class="btn btn-ghost btn-sm" data-action="edit" data-id="${pkg.id}">Edit</button>
                    <button class="btn btn-danger btn-sm" data-action="delete" data-id="${pkg.id}">Hapus</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    function renderFAQList() {
        const tbody = document.querySelector('#faqTable tbody');
        tbody.innerHTML = '';

        faqItems.forEach((item, index) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${item.question}</td>
                <td>${item.answer}</td>
                <td>
                    <button class="btn btn-ghost btn-sm" data-action="edit-faq" data-index="${index}">Edit</button>
                    <button class="btn btn-danger btn-sm" data-action="delete-faq" data-index="${index}">Hapus</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    function renderSettingsForm() {
        document.getElementById('heroTitle').value = settings.heroTitle || 'Stabil untuk Semua Kebutuhan';
        document.getElementById('heroDescription').value = settings.heroDescription || 'Nikmati pengalaman internet terbaik dengan harga terjangkau. Instalasi gratis dan dukungan teknis 24/7.';
        document.getElementById('aboutTitle').value = settings.aboutTitle || 'Tentang DEDE05 TASIK';
        document.getElementById('aboutDescription1').value = settings.aboutDescription1 || 'Kami adalah penyedia layanan internet lokal yang berfokus pada kualitas, respon cepat, dan harga yang bersaing. Beroperasi di wilayah Tasikmalaya dan sekitarnya dengan teknisi lokal yang handal.';
        document.getElementById('aboutDescription2').value = settings.aboutDescription2 || 'Dengan pengalaman lebih dari 5 tahun di industri telekomunikasi, kami berkomitmen untuk memberikan layanan terbaik kepada pelanggan dengan jaringan yang stabil dan dukungan 24/7.';
        document.getElementById('footerDescription').value = settings.description || 'Penyedia layanan internet lokal di Tasikmalaya dengan koneksi stabil dan harga terjangkau. Dukungan teknis 24/7 untuk kepuasan pelanggan.';
        document.getElementById('whatsapp').value = settings.whatsapp || '0812-XXXX-XXXX';
        document.getElementById('email').value = settings.email || 'support@dede05tasik.local';
        document.getElementById('address').value = settings.address || 'Jl. Contoh No.12, Tasikmalaya';
        document.getElementById('workingHours').value = settings.workingHours || 'Senin-Minggu: 08:00-20:00';
    }

    function renderReports() {
        const tbody = document.querySelector('#reportsTable tbody');
        tbody.innerHTML = '';

        if (!reports.length) {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td colspan="7" style="padding-top:8px;color:${'#6b7280'};">Belum ada laporan masuk.</td>`;
            tbody.appendChild(tr);
            updateReportsBadge();
            return;
        }

        reports
            .sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal))
            .forEach((r, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${r.nama}</td>
                    <td>${r.telepon}</td>
                    <td>${r.alamat}</td>
                    <td>
                        <div><strong>${r.jenisMasalah}</strong></div>
                        <div style="margin-top:2px;">${r.keterangan || '-'}</div>
                    </td>
                    <td>${new Date(r.tanggal).toLocaleString('id-ID')}</td>
                    <td>
                        <select data-report-index="${index}" class="form-select report-status-select">
                            <option value="pending"${r.status === 'pending' ? ' selected' : ''}>Pending</option>
                            <option value="proses"${r.status === 'proses' ? ' selected' : ''}>Diproses</option>
                            <option value="selesai"${r.status === 'selesai' ? ' selected' : ''}>Selesai</option>
                        </select>
                    </td>
                    <td>
                        <button class="btn btn-danger btn-sm" data-action="delete-report" data-index="${index}">Hapus</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });

        updateReportsBadge();
    }

    function updateReportsBadge() {
        const badge = document.getElementById('badgeReports');
        if (!badge) return;
        badge.textContent = reports.length;
    }

    // Event handlers
    document.getElementById('logoutBtn').addEventListener('click', () => {
        localStorage.removeItem('adminLoggedIn');
        window.location.href = 'admin-login.html';
    });

    // Nav tab switching
    document.querySelectorAll('.nav-link').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.nav-link').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const targetId = btn.getAttribute('data-target');
            document.querySelectorAll('.tab').forEach(tab => {
                tab.style.display = (tab.id === targetId) ? 'block' : 'none';
            });
        });
    });

    // Paket: simpan / edit
    document.getElementById('btnSavePackage').addEventListener('click', () => {
        const name = document.getElementById('pkgName').value.trim();
        const speedValue = document.getElementById('pkgSpeed').value.trim();
        const price = document.getElementById('pkgPrice').value.trim();
        const status = document.getElementById('pkgStatus').value;
        const featuresText = document.getElementById('pkgFeatures').value.trim();
        const popular = document.getElementById('pkgPopular').value === 'true';
        const editingId = document.getElementById('pkgEditingId').value;

        if (!name || !speedValue || !price) {
            showNotification('Nama, speed, dan harga wajib diisi.');
            return;
        }

        const speed = speedValue + ' Mbps';
        const features = featuresText
            ? featuresText.split('\n').map(f => f.trim()).filter(f => f)
            : [];

        if (editingId) {
            // update existing
            const idNum = Number(editingId);
            packages = packages.map(p => p.id === idNum ? {
                ...p,
                name,
                speed,
                price,
                status,
                popular,
                features
            } : p);
        } else {
            // new
            const newId = Date.now();
            packages.push({
                id: newId,
                name,
                speed,
                price,
                status,
                popular,
                features
            });
        }

        savePackages();
        renderPackages();
        clearPackageForm();
    });

    function clearPackageForm() {
        document.getElementById('pkgName').value = '';
        document.getElementById('pkgSpeed').value = '';
        document.getElementById('pkgPrice').value = '';
        document.getElementById('pkgStatus').value = 'active';
        document.getElementById('pkgFeatures').value = '';
        document.getElementById('pkgPopular').value = 'false';
        document.getElementById('pkgEditingId').value = '';
    }

    document.getElementById('btnClearPackageForm').addEventListener('click', clearPackageForm);

    // Handle edit/delete paket
    document.querySelector('#packagesTable tbody').addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;

        const action = btn.getAttribute('data-action');
        const id = Number(btn.getAttribute('data-id'));

        if (action === 'edit') {
            const pkg = packages.find(p => p.id === id);
            if (!pkg) return;
            document.getElementById('pkgName').value = pkg.name;
            document.getElementById('pkgSpeed').value = pkg.speed.split(' ')[0];
            document.getElementById('pkgPrice').value = pkg.price;
            document.getElementById('pkgStatus').value = pkg.status;
            document.getElementById('pkgPopular').value = pkg.popular ? 'true' : 'false';
            document.getElementById('pkgFeatures').value = (pkg.features || []).join('\n');
            document.getElementById('pkgEditingId').value = pkg.id;
            showNotification('Paket dimuat ke form, silakan edit lalu simpan.');
        }

        if (action === 'delete') {
            if (!confirm('Yakin ingin menghapus paket ini?')) return;
            packages = packages.filter(p => p.id !== id);
            savePackages();
            renderPackages();
        }
    });

    // FAQ: simpan
    document.getElementById('btnSaveFAQ').addEventListener('click', () => {
        const question = document.getElementById('faqQuestion').value.trim();
        const answer = document.getElementById('faqAnswer').value.trim();
        const editingIndex = document.getElementById('faqEditingIndex').value;

        if (!question || !answer) {
            showNotification('Pertanyaan dan jawaban wajib diisi.');
            return;
        }

        if (editingIndex !== '') {
            const idx = Number(editingIndex);
            faqItems[idx] = { question, answer };
        } else {
            faqItems.push({ question, answer });
        }

        saveFAQ();
        renderFAQList();
        clearFAQForm();
    });

    function clearFAQForm() {
        document.getElementById('faqQuestion').value = '';
        document.getElementById('faqAnswer').value = '';
        document.getElementById('faqEditingIndex').value = '';
    }

    document.getElementById('btnClearFAQForm').addEventListener('click', clearFAQForm);

    document.querySelector('#faqTable tbody').addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;

        const action = btn.getAttribute('data-action');
        const index = Number(btn.getAttribute('data-index'));

        if (action === 'edit-faq') {
            const item = faqItems[index];
            if (!item) return;
            document.getElementById('faqQuestion').value = item.question;
            document.getElementById('faqAnswer').value = item.answer;
            document.getElementById('faqEditingIndex').value = index;
        }

        if (action === 'delete-faq') {
            if (!confirm('Yakin ingin menghapus FAQ ini?')) return;
            faqItems.splice(index, 1);
            saveFAQ();
            renderFAQList();
        }
    });

    // Settings: simpan
    document.getElementById('btnSaveSettings').addEventListener('click', () => {
        settings.heroTitle = document.getElementById('heroTitle').value.trim();
        settings.heroDescription = document.getElementById('heroDescription').value.trim();
        settings.aboutTitle = document.getElementById('aboutTitle').value.trim();
        settings.aboutDescription1 = document.getElementById('aboutDescription1').value.trim();
        settings.aboutDescription2 = document.getElementById('aboutDescription2').value.trim();
        settings.description = document.getElementById('footerDescription').value.trim();
        settings.whatsapp = document.getElementById('whatsapp').value.trim();
        settings.email = document.getElementById('email').value.trim();
        settings.address = document.getElementById('address').value.trim();
        settings.workingHours = document.getElementById('workingHours').value.trim();

        saveSettings();
    });

    // Reports: change status / delete / clear all
    document.querySelector('#reportsTable tbody').addEventListener('change', (e) => {
        if (e.target.classList.contains('report-status-select')) {
            const index = Number(e.target.getAttribute('data-report-index'));
            const val = e.target.value;
            if (!reports[index]) return;
            reports[index].status = val;
            saveReports();
            showNotification('Status laporan diperbarui.');
        }
    });

    document.querySelector('#reportsTable tbody').addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        const action = btn.getAttribute('data-action');
        const index = Number(btn.getAttribute('data-index'));
        if (action === 'delete-report') {
            if (!confirm('Yakin ingin menghapus laporan ini?')) return;
            reports.splice(index, 1);
            saveReports();
            renderReports();
            showNotification('Laporan dihapus.');
        }
    });

    document.getElementById('btnClearReports').addEventListener('click', () => {
        if (!reports.length) {
            showNotification('Belum ada laporan yang perlu dihapus.');
            return;
        }
        if (!confirm('Yakin ingin menghapus semua laporan?')) return;
        reports = [];
        saveReports();
        renderReports();
        showNotification('Semua laporan dihapus.');
    });

    // Init
    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        renderPackages();
        renderFAQList();
        renderSettingsForm();
        renderReports();
    });
</script>
</body>
</html>
